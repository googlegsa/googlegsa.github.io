<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>ReleaseProcess</title>
    <link rel="stylesheet" type="text/css" href="../css/common.css">
  </head>
  <body>
    <div style="max-width: 1024px;">
      <h1> ReleaseProcess </h1>
      <div>
        <h1> <a id="CommandsToProduceNewReleases"></a> Commands to produce new releases </h1>
        <p><strong>Note: These command sequences are not scripts.</strong></p>
        <p><strong>Note: These command sequences are intended to be performed manually while being aware of what is happening and noticing errors and adjusting appropriately.</strong></p>
        <p><strong>Note: Ensure you're using appropriate versions of JDK (<a href="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase6-419409.html">JDK 6</a> for the Library; JDK 7 for the Adaptors).</strong></br>
        As of release v4.1.1, four of the Adaptors do <strong>require</strong> JDK 7:</p>
       <table style="border: 1px solid gray; padding: 5px;">
         <thead>
           <th> Component </th>
           <th> Minimum Supported JDK </th>
           <th> JDK used to build release </th>
         </thead>
         <tbody>
           <tr bgcolor=c1f0c1>
             <td> <a href="https://github.com/googlegsa/library">Adaptor library</a> </td>
             <td align="center"> 6.0 </td>
             <td align="center"> 6.0 </td>
           </tr>
           <tr bgcolor=d8d8f7>
             <td> <a href="https://github.com/googlegsa/activedirectory">Active Directory</a> </td>
             <td align="center"> 6.0 </td>
             <td align="center"> 7.0 </td>
           </tr>
           <tr bgcolor=c1f0c1>
             <td> <a href="https://github.com/googlegsa/database">Database</a> </td>
             <td align="center"> 7.0 </td>
             <td align="center"> 7.0 </td>
           </tr>
           <tr bgcolor=d8d8f7>
             <td> <a href="https://github.com/googlegsa/documentum">Documentum</a> </td>
             <td align="center"> 7.0 </td>
             <td align="center"> 7.0 </td>
           </tr>
           <tr bgcolor=c1f0c1>
             <td> <a href="https://github.com/googlegsa/filesystem">File System</a> </td>
             <td align="center"> 7.0 </td>
             <td align="center"> 7.0 </td>
           </tr>
           <tr bgcolor=d8d8f7>
             <td> <a href="https://github.com/googlegsa/ldap">Ldap</a> </td>
             <td align="center"> 6.0 </td>
             <td align="center"> 7.0 </td>
           </tr>
           <tr bgcolor=c1f0c1>
             <td> <a href="https://github.com/googlegsa/opentext">Open Text</a> </td>
             <td align="center"> 7.0 </td>
             <td align="center"> 7.0 </td>
           </tr>
           <tr bgcolor=d8d8f7>
             <td> <a href="https://github.com/googlegsa/sharepoint">SharePoint &amp; SharePoint User Profiles</a> </td>
             <td align="center"> 6.0 </td>
             <td align="center"> 7.0 </td>
           </tr>
         </tbody>
       </table>
        <ul>
          <li> <a href="#CommandsToProduceNewReleases">Commands to produce new releases</a> 
            <ul>
              <li> <a href="#CreateReleaseBranch">Create release branch</a> </li>
              <li> <a href="#BuildRcOfLibrary">Build RC of library</a> </li>
              <li> <a href="#ExtractDocumentationZip">Extract documentation zip from full distribution zip</a> </li>
              <li> <a href="#BuildRcOfAdaptor">Build RC of adaptor</a> </li>
              <li> <a href="#Release">Release library or adaptor</a> </li>
            </ul>
          </li>
        </ul>

        <h3> <a id="CreateReleaseBranch"></a> Create release branch </h3>
        <pre>
          <code>
            BRANCH=v4.1.x

            # Make sure local code is up-to-date
            git checkout master
            git pull

            # Create branch
            git checkout -b $BRANCH
            # Push branch for others to see
            git push -u origin $BRANCH

            #### In other local clones (optional) ####
            # Get new branch
            git fetch
            # Create a local branch that pulls/pushes to origin/$BRANCH
            git branch $BRANCH origin/$BRANCH
          </code>
        </pre>

        <h3> <a id="BuildRcOfLibrary"></a> Build RC of library </h3>
        <pre>
          <code>
            VERSION=4.1.2

            # Get a new clone.
            cd ~
            git clone https://github.com/googlegsa/library library-$VERSION
            cd library-$VERSION
            git checkout $BRANCH

            # Update the branch, if releases are from master, to the
            # commit for this RC build.
            git merge --ff-only origin/master

            # Tag the new version. Do NOT push the tag. <a id="TagVersion"></a>
            git tag -a v$VERSION -m "Version $VERSION"

            # Build the distribution.
            ant dist
          </code>
        </pre>

        <h3> <a id="ExtractDocumentationZip"></a> Extract documentation zip from full distribution zip </h3>
        <pre>
          <code>
            cd dist
            unzip adaptor-$VERSION-bin.zip adaptor-$VERSION-docs.zip
          </code>
        </pre>

        <h3> <a id="BuildRcOfAdaptor"></a> Build RC of adaptor </h3>
        <pre>
          <code>
            ADAPTOR=database
            VERSION=4.1.2

            # Have adaptor library
            # eg: cd ~/library-$VERSION/dist
            # unzip adaptor-$VERSION-bin.zip adaptor-$VERSION-withlib.jar

            # Get a new clone. Do NOT run "git submodule" commands here.
            cd ~
            git clone https://github.com/googlegsa/$ADAPTOR $ADAPTOR-$VERSION
            cd $ADAPTOR-$VERSION
            git checkout $BRANCH

            # Update the branch, if releases are from master, to the
            # commit for this RC build.
            git merge --ff-only origin/master

            # Tag the new version. Do NOT push the tag.
            git tag -a v$VERSION -m "Version $VERSION"

            # Build the distribution.
            cp ../library-$VERSION/dist/adaptor-$VERSION-withlib.jar lib/
            ant -Dadaptor.jar=lib/adaptor-$VERSION-withlib.jar dist
          </code>
        </pre>

        <h3> <a id="Release"></a> Release the library or adaptor </h3>
        <pre>
          <code>
            # Push the branch and tag.
            git push $BRANCH v$VERSION
          </code>
        </pre>

        <!--
<wiki:comment>
Scratch pad
{{{
git checkout v4.0.x
git merge $sha1beginning # for fstfwd
git cherrypick master # commit to add
git cherry v4.0.x # information to cmp checkout to this one
    # '+' we have it; target doesn't
    # '-' we both have it
git push v4.0.x:4.0.x # refspec example
git checkout -b mybranchname
git merge
git branch -D mybranch
git checkout master^^^^^
</wiki:comment>


<wiki:comment>
   NO LONGER DOING THE DOCUMENTATION THIS WAY

=== Update online documentation ===
{{{
cd ~
git clone git clone https://github.com/googlegsa/librarydocsreleased
cd plexi.documentation
rm -r *
mkdir javadoc && cd javadoc
unzip ~/plexi/dist/adaptor-$VERSION-docs.zip
git add -A
git commit -m "Update for version $VERSION"
git tag -a v$VERSION -m "Version $VERSION"
git push - -tags origin master

# Update "External links" to point to new documentation.
# Update main page to point to new release.
}}}
</wiki:comment>
        -->

      </div>
    </div>
  </body>
</html>
